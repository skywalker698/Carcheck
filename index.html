<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö Scan ‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å - ‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');

* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

body { 
    font-family: 'Sarabun', sans-serif; 
    background: #f8fafc;
    min-height: 100vh; 
    color: #1a365d; 
    line-height: 1.6;
}

.header { 
    background: linear-gradient(135deg, #1a365d 0%, #2d4a6b 100%);
    color: white; 
    padding: 32px 0; 
    box-shadow: 0 4px 20px rgba(26, 54, 93, 0.15);
    position: relative;
    text-align:center;
}

.header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #3182ce, #2c5aa0, #1a365d);
}

.header-content { 
    max-width: 1200px; 
    margin: 0 auto; 
    text-align: center; 
    padding: 0 24px;
}

.seal-text {
    font-size: 12px;
    font-weight: 700;
    color: #1a365d;
    text-align: center;
    line-height: 1.1;
}

.main-title { 
    font-size: 2.8rem; 
    font-weight: 700; 
    margin-bottom: 8px; 
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    letter-spacing: -0.02em;
}

.sub-title { 
    font-size: 1.3rem; 
    font-weight: 400; 
    opacity: 0.9;
    letter-spacing: 0.02em;
}

.container { 
    max-width: 1400px; 
    margin: 0 auto; 
    padding: 32px 24px; 
}

/* Latest Scan Display */
.latest-scan-section {
    margin-bottom: 32px;
}

.scan-status-card {
    background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
    border: 2px solid #68d391;
    border-radius: 20px;
    padding: 40px 32px;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(72, 187, 120, 0.15);
    animation: scanCardAppear 0.5s ease-out;
}

.scan-status-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: scanShimmer 2s infinite;
}

.scan-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    border-radius: 50%;
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
    animation: scanIconPulse 1.5s ease-in-out infinite;
}

.scan-checkmark {
    font-size: 2.5rem;
    color: white;
    font-weight: bold;
    animation: checkmarkAppear 0.6s ease-out 0.3s both;
}

.scan-status-text {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2f855a;
    margin-bottom: 16px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.scan-person-name {
    font-size: 3rem;
    font-weight: 700;
    color: #1a365d;
    margin-bottom: 16px;
    line-height: 1.1;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    animation: nameSlideIn 0.7s ease-out 0.5s both;
}

.scan-details {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    font-size: 1.1rem;
    color: #4a5568;
    margin-top: 20px;
    animation: detailsFadeIn 0.8s ease-out 0.7s both;
}

.scan-time {
    font-weight: 600;
    color: #2b6cb0;
}

.scan-divider {
    color: #cbd5e0;
    font-weight: bold;
}

.scan-vehicle {
    font-weight: 700;
    font-family: 'Courier New', monospace;
    background: #edf2f7;
    padding: 4px 12px;
    border-radius: 6px;
    border: 1px solid #cbd5e0;
    color: #1a365d;
}

.scan-pulse {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100px;
    height: 100px;
    transform: translate(-50%, -50%);
    border: 2px solid #48bb78;
    border-radius: 50%;
    opacity: 0;
    animation: scanPulse 2s ease-out infinite;
    pointer-events: none;
}

/* Update Notification */
.update-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
    z-index: 1000;
    transform: translateX(400px);
    transition: transform 0.3s ease;
    font-weight: 500;
}

.update-notification.show {
    transform: translateX(0);
}

/* Smooth Update Animations */
.smooth-update {
    transition: all 0.3s ease;
}

.data-row-new {
    background: linear-gradient(90deg, rgba(72, 187, 120, 0.1) 0%, transparent 100%);
    animation: newRowHighlight 2s ease-out;
}

.data-updated {
    animation: dataUpdatePulse 0.5s ease-out;
}

/* Animations */
@keyframes scanCardAppear {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes scanShimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

@keyframes scanIconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes checkmarkAppear {
    from {
        opacity: 0;
        transform: scale(0.3) rotate(-10deg);
    }
    to {
        opacity: 1;
        transform: scale(1) rotate(0deg);
    }
}

@keyframes nameSlideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes detailsFadeIn {
    from {
        opacity: 0;
        transform: translateY(15px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes scanPulse {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
    }
    50% {
        opacity: 0.6;
        transform: translate(-50%, -50%) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(1.5);
    }
}

@keyframes newRowHighlight {
    0% {
        background: linear-gradient(90deg, rgba(72, 187, 120, 0.3) 0%, transparent 100%);
    }
    100% {
        background: transparent;
    }
}

@keyframes dataUpdatePulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

.status-section {
    background: white;
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 32px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1a365d;
    margin-bottom: 24px;
    text-align: center;
    position: relative;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: #1a365d;
    border-radius: 2px;
}

.status-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
    gap: 20px;
}

.status-card { 
    background: white;
    border-radius: 12px; 
    padding: 24px 20px; 
    text-align: center;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.status-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #1a365d, #3182ce);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.status-card:hover::before {
    transform: scaleX(1);
}

.status-card:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 8px 25px rgba(26, 54, 93, 0.1);
    border-color: #cbd5e0;
}

.card-label { 
    font-size: 0.875rem; 
    font-weight: 600; 
    color: #718096; 
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.card-value { 
    font-size: 2.5rem; 
    font-weight: 700; 
    color: #1a365d; 
    margin-bottom: 8px;
    line-height: 1;
}

.card-description { 
    color: #718096; 
    font-size: 0.875rem;
    font-weight: 400;
}

.latest-info {
    background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
    border: 1px solid #90cdf4;
    border-radius: 8px;
    padding: 12px 16px;
    margin-top: 12px;
}

.latest-label {
    font-size: 0.75rem;
    color: #2b6cb0;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 4px;
}

.latest-name {
    font-size: 0.875rem;
    font-weight: 600;
    color: #1a365d;
}

/* Charts Section */
.charts-section {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
    margin-bottom: 32px;
}

.chart-container {
    background: white;
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
}

.chart-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1a365d;
    margin-bottom: 24px;
    text-align: center;
    position: relative;
}

.chart-title::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 2px;
    background: #3182ce;
    border-radius: 2px;
}

/* Ranking Header Styles */
.ranking-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 12px;
}

.ranking-toggle-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: linear-gradient(135deg, #3182ce 0%, #2c5aa0 100%);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 600;
    font-family: 'Sarabun', sans-serif;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(49, 130, 206, 0.2);
}

.ranking-toggle-btn:hover {
    background: linear-gradient(135deg, #2c5aa0 0%, #1a365d 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(49, 130, 206, 0.3);
}

.ranking-toggle-btn:active {
    transform: translateY(0);
}

#toggleIcon {
    font-size: 1rem;
    font-weight: bold;
    transition: transform 0.3s ease;
}

.ranking-toggle-btn.descending #toggleIcon {
    transform: rotate(180deg);
}

#barChart {
  width: auto !important;
  height: 400px !important;
}

.ranking-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.ranking-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    margin-bottom: 8px;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    border-radius: 8px;
    border-left: 4px solid #3182ce;
    transition: all 0.3s ease;
}

.ranking-item:hover {
    background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
    transform: translateX(4px);
}

.ranking-position {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1a365d;
    margin-right: 16px;
    min-width: 24px;
    text-align: center;
}

.ranking-info {
    flex: 1;
}

.ranking-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: #1a365d;
    margin-bottom: 4px;
}

.ranking-count {
    font-size: 0.75rem;
    color: #718096;
}

.ranking-count-number {
    font-weight: 600;
    color: #2b6cb0;
}

.data-section {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
}

.table-header { 
    background: linear-gradient(135deg, #1a365d 0%, #2d4a6b 100%);
    color: white; 
    padding: 24px 32px;
}

.table-title { 
    font-size: 1.5rem; 
    font-weight: 600; 
    margin-bottom: 4px;
}

.table-subtitle { 
    opacity: 0.9; 
    font-size: 0.975rem;
}

.table-controls { 
    padding: 24px 32px; 
    border-bottom: 1px solid #e2e8f0;
    background: #f7fafc;
    display: flex; 
    gap: 16px; 
    align-items: center; 
    flex-wrap: wrap;
    justify-content: space-between;
}

.search-input { 
    flex: 1; 
    min-width: 280px; 
    padding: 12px 16px; 
    border: 1px solid #cbd5e0; 
    border-radius: 8px; 
    font-size: 0.975rem;
    font-family: 'Sarabun', sans-serif;
    background: white;
    transition: all 0.2s ease;
}

.search-input:focus { 
    outline: none; 
    border-color: #3182ce; 
    box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
}

.search-input::placeholder {
    color: #a0aec0;
}

.table-controls-right {
    display: flex;
    align-items: center;
    gap: 16px;
}

.records-info {
    color: #718096;
    font-size: 0.875rem;
    font-weight: 500;
}

.refresh-btn { 
    padding: 12px 24px; 
    background: linear-gradient(135deg, #1a365d 0%, #2d4a6b 100%);
    color: white; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    font-weight: 600;
    font-size: 0.875rem;
    font-family: 'Sarabun', sans-serif;
    transition: all 0.2s ease;
    min-width: 140px;
    position: relative;
    overflow: hidden;
}

.refresh-btn:hover { 
    transform: translateY(-1px); 
    box-shadow: 0 4px 12px rgba(26, 54, 93, 0.25);
    background: linear-gradient(135deg, #2d4a6b 0%, #3182ce 100%);
}

.refresh-btn:active {
    transform: translateY(0);
}

.refresh-btn.loading {
    pointer-events: none;
    opacity: 0.7;
}

.table-container { 
    overflow-x: auto; 
    max-height: 500px;
}

table { 
    width: 100%; 
    border-collapse: collapse;
    background: white;
}

th, td { 
    padding: 16px 20px; 
    text-align: left; 
    border-bottom: 1px solid #e2e8f0;
    font-size: 0.875rem;
}

th { 
    background: linear-gradient(180deg, #f7fafc 0%, #edf2f7 100%);
    font-weight: 600; 
    color: #1a365d; 
    position: sticky; 
    top: 0; 
    z-index: 10;
    border-bottom: 2px solid #cbd5e0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.75rem;
}

tr:hover { 
    background: #f7fafc;
}

tr:nth-child(even) {
    background: #fbfcfe;
}

tr:nth-child(even):hover {
    background: #f7fafc;
}

.status-badge { 
    padding: 6px 12px; 
    border-radius: 6px; 
    font-size: 0.75rem; 
    font-weight: 500; 
    text-align: center;
    display: inline-block;
    background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
    color: #2b6cb0;
    border: 1px solid #90cdf4;
}

.loading { 
    text-align: center; 
    padding: 48px; 
    color: #718096;
    font-size: 1rem;
    font-weight: 500;
}

.error { 
    text-align: center; 
    padding: 48px; 
    color: #e53e3e; 
    background: #fed7d7; 
    border-radius: 8px; 
    margin: 20px;
    font-size: 1rem;
    font-weight: 500;
}

.footer {
    background: #1a365d;
    color: white;
    padding: 24px;
    margin-top: 48px;
    font-size: 0.875rem;
}

.footer-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
}

.footer-section {
    flex: 1;
    min-width: 250px;
    margin-bottom: 20px;
    padding: 0 15px;
}

.footer-title {
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    padding-bottom: 5px;
}

.footer-links {
    list-style: none;
    padding: 0;
    margin: 0;
}

.footer-links li {
    margin-bottom: 8px;
}

.footer-links a {
    color: #e6e6e6;
    text-decoration: none;
    transition: color 0.3s;
}

.footer-links a:hover {
    color: white;
    text-decoration: underline;
}

.footer-bottom {
    text-align: center;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    width: 100%;
}

.developer-credit {
    font-size: 0.8rem;
    margin-top: 10px;
    color: #cccccc;
}

.data-value {
    font-weight: 600;
    color: #1a365d;
}

.vehicle-plate {
    font-weight: 700;
    color: #1a365d;
    font-family: 'Courier New', monospace;
    background: #f7fafc;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #e2e8f0;
}

.timestamp {
    color: #718096;
    font-weight: 500;
    font-size: 0.8125rem;
}

/* Pagination Styles */
.pagination-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 32px;
    background: #f7fafc;
    border-top: 1px solid #e2e8f0;
}

.pagination {
    display: flex;
    gap: 8px;
}

.pagination button {
    padding: 8px 12px;
    border: 1px solid #cbd5e0;
    background: white;
    color: #1a365d;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.875rem;
    font-family: 'Sarabun', sans-serif;
    transition: all 0.2s ease;
}

.pagination button:hover:not(:disabled) {
    background: #ebf8ff;
    border-color: #3182ce;
}

.pagination button.active {
    background: #1a365d;
    color: white;
    border-color: #1a365d;
}

.pagination button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination-info {
    color: #718096;
    font-size: 0.875rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .charts-section {
        grid-template-columns: 1fr;
    }
    
    .container {
        max-width: 100%;
        padding: 24px 16px;
    }
}

@media (max-width: 768px) { 
    .main-title { font-size: 2rem; }
    .sub-title { font-size: 1.1rem; }
    .container { padding: 24px 16px; }
    .status-section { padding: 24px 20px; }
    .table-header { padding: 20px 24px; }
    .table-controls { 
        padding: 20px 24px; 
        flex-direction: column; 
        align-items: stretch; 
        gap: 12px;
    }
    .table-controls-right {
        justify-content: space-between;
        width: 100%;
    }
    .search-input { 
        min-width: 100%; 
        margin-bottom: 8px;
    }
    .refresh-btn {
        width: auto;
    }
    th, td { 
        padding: 12px 16px; 
        font-size: 0.8125rem; 
    }
    .government-seal {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 10px;

    }
    .seal-logo {
        width: 32px;
        height: auto;
    } 
    .seal-text {
        font-size: 10px;
    }
    .status-grid { 
        grid-template-columns: 1fr; 
        gap: 16px; 
    }
    .card-value { 
        font-size: 2rem; 
    }
    
    /* Latest scan responsive */
    .scan-status-card {
        padding: 32px 24px;
    }
    .scan-person-name {
        font-size: 2.2rem;
    }
    .scan-icon {
        width: 60px;
        height: 60px;
    }
    .scan-checkmark {
        font-size: 2rem;
    }
    .scan-status-text {
        font-size: 1.2rem;
    }
    .scan-details {
        flex-direction: column;
        gap: 8px;
    }
    .scan-divider {
        display: none;
    }
    
    .pagination-container {
        flex-direction: column;
        gap: 16px;
        padding: 16px 24px;
    }
    
    .charts-section {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .chart-container {
        padding: 24px 20px;
    }

    .update-notification {
        right: 10px;
        top: 10px;
        font-size: 0.85rem;
    }
    
    /* Responsive ranking header */
    .ranking-header {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
    }
    
    .chart-title {
        margin-bottom: 12px;
    }
    
    .ranking-toggle-btn {
        align-self: center;
        font-size: 0.75rem;
    }
}

@media (max-width: 480px) {
    .main-title { font-size: 1.75rem; }
    .container { padding: 20px 12px; }
    .status-section { padding: 20px 16px; }
    .table-controls { padding: 16px 20px; }
    .card-value { font-size: 1.875rem; }
    th, td { 
        padding: 10px 12px; 
        font-size: 0.75rem; 
    }
    .vehicle-plate {
        font-size: 0.75rem;
        padding: 2px 6px;
    }
    
    /* Latest scan mobile */
    .scan-status-card {
        padding: 24px 16px;
    }
    .scan-person-name {
        font-size: 1.8rem;
    }
    .scan-icon {
        width: 50px;
        height: 50px;
    }
    .scan-checkmark {
        font-size: 1.5rem;
    }
    .scan-status-text {
        font-size: 1rem;
    }
    .scan-details {
        font-size: 0.9rem;
    }
}

/* Loading Animation */
.loading::after {
    content: '';
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid #cbd5e0;
    border-top: 2px solid #3182ce;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-left: 12px;
    vertical-align: middle;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Smooth transitions */
* {
    transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}
.fade-in {
  opacity: 0;
  transition: opacity 0.5s ease-in;
}
.fade-in.show {
  opacity: 1;
}
.data-row-new {
  background-color: #e6ffe6; /* ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏≠‡πà‡∏≠‡∏ô */
  transition: background-color 2s ease-out;
}
.data-row-new.show {
  background-color: transparent; /* ‡∏à‡∏≤‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏õ */
}
/* Trophy icons for positions 1, 2, 3 */
.ranking-position.trophy-1::before {
    content: "üèÜ";
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 20px;
    background: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.ranking-position.trophy-2::before {
    content: "ü•à";
     position: absolute;
    top: -8px;
    right: -8px;
    font-size: 20px;
    background: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.ranking-position.trophy-3::before {
    content: "ü•â";
     position: absolute;
    top: -8px;
    right: -8px;
    font-size: 20px;
    background: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

/* ‡∏™‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1-3 */
.ranking-position.trophy-1 {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #333;
}

.ranking-position.trophy-2 {
    background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
    color: #333;
}

.ranking-position.trophy-3 {
    background: linear-gradient(135deg, #cd7f32, #daa520);
    color: white;
}
</style>
</head>
<body>

<!-- Update Notification -->
<div id="updateNotification" class="update-notification">
    ‚úì ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß
</div>

<header class="header">
    <div class="government-seal">
        <img src="https://i.ibb.co/wZKsKcyR/logo-2.png" alt="‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå" class="seal-logo">
    </div>
    <div class="header-content">
        <h1 class="main-title">‡∏£‡∏∞‡∏ö‡∏ö Scan ‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å</h1>
        <p class="sub-title">‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</p>
    </div>
</header>

<div class="container">
    <!-- Latest Scan Display -->
    <div class="latest-scan-section">
        <div class="scan-status-card" id="scanStatusCard">
            <div class="scan-icon">
                <div class="scan-checkmark">‚úì</div>
            </div>
            <div class="scan-status-text">‡∏™‡πÅ‡∏Å‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div>
            <div class="scan-person-name" id="latestScanName">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            <div class="scan-details">
                <span class="scan-time" id="latestScanTime">-</span>
                <span class="scan-divider">|</span>
                <span class="scan-vehicle" id="latestScanVehicle">-</span>
            </div>
            <div class="scan-pulse"></div>
        </div>
    </div>

    <div class="status-section">
        <h2 class="section-title">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <div class="status-grid">
            <div class="status-card">
                <div class="card-label">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="card-value smooth-update" id="totalCount">-</div>
                <div class="card-description">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
            <div class="status-card">
                <div class="card-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô</div>
                <div class="card-value smooth-update" id="inCount">-</div>
                <div class="card-description">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô</div>
            </div>
            <div class="status-card">
                <div class="card-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ñ</div>
                <div class="card-value smooth-update" id="outCount">-</div>
                <div class="card-description">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô</div>
            </div>
            <div class="status-card">
                <div class="card-label">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                <div class="card-value smooth-update" style="font-size: 1.5rem;" id="lastUpdate">-</div>
                <div class="card-description">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                <div class="latest-info" id="latestInfo" style="display: none;">
                    <div class="latest-label">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                    <div class="latest-name" id="latestName">-</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
        <div class="chart-container">
            <h3 class="chart-title">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</h3>
            <canvas id="barChart"></canvas>
        </div>
        <div class="chart-container">
            <div class="ranking-header">
                <h3 class="chart-title" id="rankingTitle">5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                <button class="ranking-toggle-btn" id="rankingToggleBtn" onclick="toggleRankingMode()">
                    <span id="toggleIcon">‚Üë</span> ‡∏™‡πÅ‡∏Å‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                </button>
            </div>
            <ul class="ranking-list" id="rankingList">
                <li class="ranking-item">
                    <div class="ranking-position">1</div>
                    <div class="ranking-info">
                        <div class="ranking-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                        <div class="ranking-count">‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="data-section">
        <div class="table-header">
            <h2 class="table-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å</h2>
            <p class="table-subtitle">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
        </div>
        <div class="table-controls">
            <input type="text" class="search-input" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ...">
            <div class="table-controls-right">
                <div class="records-info" id="recordsInfo">‡πÅ‡∏™‡∏î‡∏á 0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                <button class="refresh-btn" onclick="loadData()" id="refreshBtn">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                        <th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</th>
                        <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</th>
                    </tr>
                </thead>
                <tbody id="dataBody">
                    <tr><td colspan="5" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
                </tbody>
            </table>
        </div>
        <div class="pagination-container">
            <div class="pagination-info" id="paginationInfo">‡πÅ‡∏™‡∏î‡∏á 0 - 0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
            <div class="pagination" id="pagination">
                <button onclick="changePage('prev')" id="prevBtn" disabled>‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
                <button onclick="changePage('next')" id="nextBtn" disabled>‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="footer-container">
        <div class="footer-section">
            <div class="footer-title">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</div>
            <ul class="footer-links">
                <li><a href="#">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</a></li>
                <li><a href="#">‡∏ß‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå : ‡∏à‡∏á‡∏ä‡∏ô‡∏∞‡πÉ‡∏à‡∏ï‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏¢‡∏¥‡πâ‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç</a></li>
                <li><a href="#">‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</a></li>
                <li><a href="#">‡∏Ñ‡∏ì‡∏∞‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <div class="footer-title">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</div>
            <ul class="footer-links">
                <li><a href="#">‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•</a></li>
                <li><a href="#">‡πÇ‡∏°‡∏•‡∏≤‡∏™,‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏•‡∏∞ ‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡πâ‡∏≠‡∏¢</a></li>
                <li><a href="#">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</a></li>
                <li><a href="#">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <div class="footer-title">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</div>
            <ul class="footer-links">
                <li>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î</li>
                <li>Thai Identity Sugar Factory Co., Ltd.</li>
                <li>42/1 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 8 ‡∏ï‡∏≥‡∏ö‡∏•‡∏Ñ‡∏∏‡πâ‡∏á‡∏ï‡∏∞‡πÄ‡∏†‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏°‡∏∑‡∏≠‡∏á</li>
                <li>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå 53000</li>
                <li>‡πÇ‡∏ó‡∏£: 055-407-241</li>
                <li>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ktisgroup.com</li>
            </ul>
        </div>
    </div>
    
    <div class="footer-bottom">
        <p>¬© 2025 ‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå - ‡∏£‡∏∞‡∏ö‡∏ö Dash-Tis ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å ‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</p>
        <div class="developer-credit">
            ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Se.Wittwat.K
        </div>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbx5ttV6fxZLdcF3hhLqt-IaDS_sl5McRNWF5Z-zHLUfZi2YX8XhUBsEAJxBNrl2lP0u/exec?action=getLog';
let allData = [];
let filteredData = [];
let lastRawData = ""; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
let barChart = null;
let isLoading = false;
let isDescendingOrder = false; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö

// Pagination variables
let currentPage = 1;
const recordsPerPage = 10;

// Smooth update functions
function showUpdateNotification() {
    const notification = document.getElementById('updateNotification');
    notification.classList.add('show');
    setTimeout(() => {
        notification.classList.remove('show');
    }, 2000);
}

function animateValueChange(element, newValue) {
    const oldValue = element.textContent;
    if (oldValue !== newValue && oldValue !== '-') {
        element.classList.add('data-updated');
        setTimeout(() => {
            element.classList.remove('data-updated');
        }, 500);
    }
    element.textContent = newValue;
}



function formatDateTime(value) {
    if (!value) return '-';

    let date;

    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô string
    if (typeof value === 'string') {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ISO 2025-09-22T01:40:17.121Z
        date = new Date(value);
        if (isNaN(date.getTime())) {
            // fallback: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö "22/9/2025, 14:18:39"
            const parts = value.split(',');
            if (parts.length === 2) {
                const dateParts = parts[0].trim().split('/');
                const timeParts = parts[1].trim().split(':');
                if (dateParts.length === 3 && timeParts.length === 3) {
                    const day = parseInt(dateParts[0], 10);
                    const month = parseInt(dateParts[1], 10) - 1;
                    const year = parseInt(dateParts[2], 10);
                    const hour = parseInt(timeParts[0], 10);
                    const min = parseInt(timeParts[1], 10);
                    const sec = parseInt(timeParts[2], 10);
                    date = new Date(year, month, day, hour, min, sec);
                }
            }
        }
    }

    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô number (Excel timestamp)
    if (typeof value === 'number') {
        date = new Date((value - 25569) * 86400 * 1000);
    }

    if (!(date instanceof Date) || isNaN(date.getTime())) return '-';

    return date.toLocaleString('th-TH', {
        year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', second:'2-digit'
    });
}

// function updateTable() {
//     const tbody = document.getElementById('dataBody');
//     const startIndex = (currentPage - 1) * recordsPerPage;
//     const endIndex = startIndex + recordsPerPage;
//     const paginatedData = filteredData.slice(startIndex, endIndex);
    
//     if (!paginatedData.length) {
//         tbody.innerHTML = '<tr><td colspan="5" class="loading">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td></tr>';
//         return;
//     }
    
//     // Create new rows with smooth animation for new data
//     const newRows = paginatedData.map((r, index) => {
//         const isNewRow = startIndex + index === 0 && currentPage === 1; // First row on first page
//         const rowClass = isNewRow ? 'data-row-new' : '';
        
//         return `
//             <tr class="${rowClass}">
//                 <td><span class="data-value">${r.id}</span></td>
//                 <td><span class="data-value">${r.name}</span></td>
//                 <td><span class="status-badge">${r.pathname}</span></td>
//                 <td><span class="vehicle-plate">${r.carRegis}</span></td>
//                 <td><span class="timestamp">${r.timestamp}</span></td>
//             </tr>
//         `;
//     }).join('');
    
//     tbody.innerHTML = newRows;
    
//     // Update records info with smooth transition
//     const recordsInfo = document.getElementById('recordsInfo');
//     const newRecordsText = `‡πÅ‡∏™‡∏î‡∏á ${Math.min(filteredData.length, recordsPerPage)} ‡∏à‡∏≤‡∏Å ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    
//     if (recordsInfo.textContent !== newRecordsText) {
//         recordsInfo.style.opacity = '0.7';
//         setTimeout(() => {
//             recordsInfo.textContent = newRecordsText;
//             recordsInfo.style.opacity = '1';
//         }, 150);
//     }
// }

// ===================== loadData =====================
async function loadData(showNotification = false) {
    if (isLoading) return;

    try {
        isLoading = true;
        const refreshBtn = document.getElementById('refreshBtn');

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        if (!allData.length) {
            document.getElementById('dataBody').innerHTML = '<tr><td colspan="5" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        }

        // Add loading state to refresh button
        if (refreshBtn) {
            refreshBtn.classList.add('loading');
            refreshBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...';
        }

        const response = await fetch(API_URL);
        const jsonData = await response.json();

        const currentRaw = JSON.stringify(jsonData);
        const hasNewData = currentRaw !== lastRawData;

        lastRawData = currentRaw;

        const previousLatest = allData.length > 0 ? allData[0] : null;

        allData = jsonData.map(r => ({
            id: r["ID"] ?? '',
            name: r["name"] ?? '',
            pathname: r["pathname"] ?? '',
            carRegis: r["car_regis"] ?? '',
            timestamp: formatDateTime(r["Timestamp"]),
            rawTimestamp: r["Timestamp"]
        }));

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏° timestamp ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô
        allData.sort((a, b) => new Date(b.rawTimestamp) - new Date(a.rawTimestamp));

        // =================== ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï filteredData ‡∏ï‡∏≤‡∏° search ===================
        const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
        filteredData = searchTerm === ''
            ? [...allData]
            : allData.filter(r =>
                r.id.toString().toLowerCase().includes(searchTerm) ||
                r.name?.toLowerCase().includes(searchTerm) ||
                r.pathname?.toLowerCase().includes(searchTerm) ||
                r.carRegis?.toLowerCase().includes(searchTerm)
            );

        // Reset ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        if (hasNewData && !searchTerm) {
            currentPage = 1;
        }

        const currentLatest = allData.length > 0 ? allData[0] : null;
        const hasNewLatest = previousLatest && currentLatest &&
            (previousLatest.id !== currentLatest.id ||
             previousLatest.rawTimestamp !== currentLatest.rawTimestamp);

        // =================== Update ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ===================
        updateTable();
        updatePagination();
        updateStats();
        updateLastUpdate();
        updateLatestPerson(hasNewLatest);
        updateCharts();
        updateRanking();

        // ‡πÅ‡∏™‡∏î‡∏á notification ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        if (hasNewData && (showNotification || hasNewLatest)) {
            showUpdateNotification();
        }

    } catch (error) {
        console.error('Error loading data:', error);
        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
    } finally {
        isLoading = false;
        if (refreshBtn) {
            refreshBtn.classList.remove('loading');
            refreshBtn.textContent = '‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        }
    }
}

// ===================== setupSearch (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß) =====================
function setupSearch() {
    const searchInput = document.getElementById('searchInput');
    let searchTimeout;

    searchInput.addEventListener('input', e => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            performSearch(e.target.value);
        }, 150); // ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤ timeout ‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
    });

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Enter key
    searchInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
            clearTimeout(searchTimeout);
            performSearch(e.target.value);
        }
    });
}
// ===================== performSearch (‡∏ü‡∏±‡∏á‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà) =====================
function performSearch(searchValue) {
    const term = searchValue.trim().toLowerCase();
    
    if (term === '') {
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        filteredData = [...allData];
    } else {
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        filteredData = allData.filter(record => {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô string ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            const id = (record.id || '').toString().toLowerCase();
            const name = (record.name || '').toString().toLowerCase();
            const pathname = (record.pathname || '').toString().toLowerCase();
            const carRegis = (record.carRegis || '').toString().toLowerCase();
            const timestamp = (record.timestamp || '').toString().toLowerCase();
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå
            return id.includes(term) || 
                   name.includes(term) || 
                   pathname.includes(term) || 
                   carRegis.includes(term) ||
                   timestamp.includes(term);
        });
    }
    
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    currentPage = 1;
    
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞ pagination
    updateTable();
    updatePagination();
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    updateSearchStatus(term, filteredData.length);
}
// ===================== updateSearchStatus (‡∏ü‡∏±‡∏á‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà) =====================
function updateSearchStatus(searchTerm, resultCount) {
    const recordsInfo = document.getElementById('recordsInfo');
    
    if (searchTerm === '') {
        recordsInfo.textContent = `‡πÅ‡∏™‡∏î‡∏á ${Math.min(allData.length, recordsPerPage)} ‡∏à‡∏≤‡∏Å ${allData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    } else {
        recordsInfo.textContent = `‡∏û‡∏ö ${resultCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å "${searchTerm}"`;
    }
}


// ===================== updateTable (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß) =====================
function updateTable() {
    const tbody = document.getElementById('dataBody');
    const startIndex = (currentPage - 1) * recordsPerPage;
    const endIndex = startIndex + recordsPerPage;
    const paginatedData = filteredData.slice(startIndex, endIndex);

    if (!paginatedData.length) {
        const searchTerm = document.getElementById('searchInput').value.trim();
        const message = searchTerm ? 
            `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö "${searchTerm}"` : 
            '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        tbody.innerHTML = `<tr><td colspan="5" class="loading">${message}</td></tr>`;
        return;
    }

    const newRows = paginatedData.map((r, index) => {
        const isNewRow = startIndex + index === 0 && currentPage === 1;
        const rowClass = isNewRow ? 'data-row-new' : '';

        return `
            <tr class="${rowClass}">
                <td><span class="data-value">${r.id ? r.id.slice(0, -2) : '-'}</span></td>
                <td><span class="data-value">${r.name || '-'}</span></td>
                <td><span class="status-badge">${r.pathname || '-'}</span></td>
                <td><span class="vehicle-plate">${r.carRegis || '-'}</span></td>
                <td><span class="timestamp">${r.timestamp || '-'}</span></td>
            </tr>
        `;
    }).join('');

    tbody.innerHTML = newRows;
}



// ===================== updatePagination (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß) =====================
function updatePagination() {
    const totalPages = Math.ceil(filteredData.length / recordsPerPage);
    const startRecord = filteredData.length === 0 ? 0 : (currentPage - 1) * recordsPerPage + 1;
    const endRecord = Math.min(currentPage * recordsPerPage, filteredData.length);
    
    // Update pagination info
    const paginationInfo = document.getElementById('paginationInfo');
    const searchTerm = document.getElementById('searchInput').value.trim();
    
    let newPaginationText;
    if (searchTerm) {
        newPaginationText = `‡πÅ‡∏™‡∏î‡∏á ${startRecord} - ${endRecord} ‡∏à‡∏≤‡∏Å ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö`;
    } else {
        newPaginationText = `‡πÅ‡∏™‡∏î‡∏á ${startRecord} - ${endRecord} ‡∏à‡∏≤‡∏Å ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }
    
    if (paginationInfo.textContent !== newPaginationText) {
        animateValueChange(paginationInfo, newPaginationText);
    }
    
    // Update pagination buttons
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    if (prevBtn) prevBtn.disabled = currentPage === 1;
    if (nextBtn) nextBtn.disabled = currentPage === totalPages || totalPages === 0;
}
// ===================== clearSearch (‡∏ü‡∏±‡∏á‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà) =====================
function clearSearch() {
    const searchInput = document.getElementById('searchInput');
    searchInput.value = '';
    performSearch('');
}

function changePage(direction) {
    const totalPages = Math.ceil(filteredData.length / recordsPerPage);
    
    if (direction === 'prev' && currentPage > 1) {
        currentPage--;
    } else if (direction === 'next' && currentPage < totalPages) {
        currentPage++;
    }
    
    updateTable();
    updatePagination();
}

function updateStats() {
    const totalCount = document.getElementById('totalCount');
    const inCount = document.getElementById('inCount');
    const outCount = document.getElementById('outCount');
    
    // Animate value changes
    animateValueChange(totalCount, allData.length);
    animateValueChange(inCount, [...new Set(allData.map(r=>r.name))].length);
    animateValueChange(outCount, [...new Set(allData.map(r=>r.carRegis))].length);
}

function updateLastUpdate() {
    const now = new Date();
    const lastUpdateElement = document.getElementById('lastUpdate');
    const newTime = now.toLocaleString('th-TH', { hour:'2-digit', minute:'2-digit' });
    
    animateValueChange(lastUpdateElement, newTime);
}

function updateLatestPerson(hasNewLatest = false) {
    const latestInfo = document.getElementById('latestInfo');
    const scanStatusCard = document.getElementById('scanStatusCard');
    const latestScanName = document.getElementById('latestScanName');
    const latestScanTime = document.getElementById('latestScanTime');
    const latestScanVehicle = document.getElementById('latestScanVehicle');
    
    if (allData.length > 0) {
        const latestPerson = allData[0]; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏•‡πá‡∏Å
        document.getElementById('latestName').textContent = `${latestPerson.name} (${latestPerson.carRegis})`;
        latestInfo.style.display = 'block';
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏ç‡πà with smooth transitions
        if (latestScanName.textContent !== latestPerson.name) {
            latestScanName.style.opacity = '0.7';
            setTimeout(() => {
                latestScanName.textContent = latestPerson.name;
                latestScanName.style.opacity = '1';
            }, 150);
        }
        
        if (latestScanTime.textContent !== latestPerson.timestamp) {
            latestScanTime.style.opacity = '0.7';
            setTimeout(() => {
                latestScanTime.textContent = latestPerson.timestamp;
                latestScanTime.style.opacity = '1';
            }, 150);
        }
        
        if (latestScanVehicle.textContent !== latestPerson.carRegis) {
            latestScanVehicle.style.opacity = '0.7';
            setTimeout(() => {
                latestScanVehicle.textContent = latestPerson.carRegis;
                latestScanVehicle.style.opacity = '1';
            }, 150);
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        if (hasNewLatest) {
            scanStatusCard.style.animation = 'none';
            setTimeout(() => {
                scanStatusCard.style.animation = 'scanCardAppear 0.5s ease-out';
            }, 10);
        }
        
    } else {
        latestInfo.style.display = 'none';
        latestScanName.textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        latestScanTime.textContent = '-';
        latestScanVehicle.textContent = '-';
    }
}

function updateCharts() {
    // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå (8 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
    const last8Weeks = [];
    const today = new Date();
    
    // ‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ
    const currentMonday = new Date(today);
    const dayOfWeek = currentMonday.getDay();
    const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå = 0
    currentMonday.setDate(currentMonday.getDate() + daysToMonday);
    
    for (let i = 7; i >= 0; i--) {
        // ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
        const weekStart = new Date(currentMonday);
        weekStart.setDate(currentMonday.getDate() - (i * 7));
        
        // ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        
        // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: "01-07 ‡∏°.‡∏Ñ." ‡∏´‡∏£‡∏∑‡∏≠ "‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        let weekStr;
        if (i === 0) {
            weekStr = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ';
        } else {
            const startDay = weekStart.getDate().toString().padStart(2, '0');
            const endDay = weekEnd.getDate().toString().padStart(2, '0');
            const monthName = weekStart.toLocaleDateString('th-TH', { month: 'short' });
            
            if (weekStart.getMonth() === weekEnd.getMonth()) {
                weekStr = `${startDay}-${endDay} ${monthName}`;
            } else {
                const endMonthName = weekEnd.toLocaleDateString('th-TH', { month: 'short' });
                weekStr = `${startDay} ${monthName}-${endDay} ${endMonthName}`;
            }
        }
        
        // ‡∏ô‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
        const weekData = allData.filter(record => {
            const recordDate = new Date(record.rawTimestamp);
            return recordDate >= weekStart && recordDate <= weekEnd;
        });
        
        last8Weeks.push({
            date: weekStr,
            count: weekData.length,
            fullDate: `${weekStart.toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit' })} - ${weekEnd.toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit' })}`
        });
    }
    
    const ctx = document.getElementById('barChart').getContext('2d');
    
    if (barChart) {
        // Smooth chart update instead of destroying
        barChart.data.labels = last8Weeks.map(d => d.date);
        barChart.data.datasets[0].data = last8Weeks.map(d => d.count);
        barChart.update('none'); // No animation for smooth update
    } else {
        barChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: last8Weeks.map(d => d.date),
                datasets: [{
                    label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô',
                    data: last8Weeks.map(d => d.count),
                    backgroundColor: 'rgba(49, 130, 206, 0.8)',
                    borderColor: 'rgba(26, 54, 93, 1)',
                    borderWidth: 1,
                    borderRadius: 6,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 500,
                    easing: 'easeInOutQuart'
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                const index = context[0].dataIndex;
                                return last8Weeks[index].fullDate;
                            },
                            label: function(context) {
                                return `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô: ${context.parsed.y} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
                            }
                        },
                        backgroundColor: 'rgba(26, 54, 93, 0.9)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: 'rgba(49, 130, 206, 1)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        displayColors: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            color: '#718096',
                            font: {
                                size: 12
                            }
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                layout: {
                    padding: {
                        top: 10,
                        bottom: 10,
                        left: 10,
                        right: 10
                    }
                }
            }
        });
    }
}

function toggleRankingMode() {
    isDescendingOrder = !isDescendingOrder;
    
    const toggleBtn = document.getElementById('rankingToggleBtn');
    const toggleIcon = document.getElementById('toggleIcon');
    const rankingTitle = document.getElementById('rankingTitle');
    
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°
    if (isDescendingOrder) {
        toggleBtn.classList.add('descending');
        toggleBtn.innerHTML = '<span id="toggleIcon">‚Üì</span> ‡∏™‡πÅ‡∏Å‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î';
        rankingTitle.textContent = '5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î';
    } else {
        toggleBtn.classList.remove('descending');
        toggleBtn.innerHTML = '<span id="toggleIcon">‚Üë</span> ‡∏™‡πÅ‡∏Å‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î';
        rankingTitle.textContent = '5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î';
    }
    
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
    updateRanking();
}

function updateRanking() {
    // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô
    const personCounts = {};
    allData.forEach(record => {
        const key = record.name;
        if (key && key !== '') {
            personCounts[key] = (personCounts[key] || 0) + 1;
        }
    });
    
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    const sortedPersons = Object.entries(personCounts)
        .sort((a, b) => {
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å (ascending) ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ (descending)
            return isDescendingOrder ? b[1] - a[1] : a[1] - b[1];
        })
        .slice(0, 5);
    
    const rankingList = document.getElementById('rankingList');
    
    if (sortedPersons.length === 0) {
        rankingList.innerHTML = `
            <li class="ranking-item">
                <div class="ranking-position">-</div>
                <div class="ranking-info">
                    <div class="ranking-name">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                    <div class="ranking-count">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                </div>
            </li>
        `;
        return;
    }
    
    const newRankingHTML = sortedPersons.map((person, index) => {
    const position = index + 1;
    let positionClass = '';
    let itemClass = '';
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡πâ‡∏ß‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©
    if (position === 1) {
        positionClass = 'trophy-1';
        itemClass = 'top-1';
    } else if (position === 2) {
        positionClass = 'trophy-2';
        itemClass = 'top-2';
    } else if (position === 3) {
        positionClass = 'trophy-3';
        itemClass = 'top-3';
    }
    
    return `
        <li class="ranking-item ${itemClass}">
            <div class="ranking-position ${positionClass}">${position}</div>
            <div class="ranking-info">
                <div class="ranking-name">${person[0]}</div>
                <div class="ranking-count">‡∏™‡πÅ‡∏Å‡∏ô <span class="ranking-count-number">${person[1]}</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
            </div>
        </li>
    `;
}).join('');
    
    // Smooth update for ranking
    if (rankingList.innerHTML !== newRankingHTML) {
        rankingList.style.opacity = '0.7';
        setTimeout(() => {
            rankingList.innerHTML = newRankingHTML;
            rankingList.style.opacity = '1';
        }, 200);
    }
}


function showError(msg) {
    document.getElementById('dataBody').innerHTML = `<tr><td colspan="5" class="error">${msg}</td></tr>`;
}

// Manual refresh function with notification
function manualRefresh() {
    loadData(true);
}

async function startLiveUpdate() {
    let lastId = null;
    let lastTimestamp = null;

    while (true) {
        try {
            const res = await fetch(API_URL + "?action=getLatestId");
            const data = await res.json();

            // üìå ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏° effect
            if (data.latestId !== lastId || data.latestTimestamp !== lastTimestamp) {
                console.log("üì¢ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà ‚Üí ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≤‡∏£‡∏≤‡∏á");
                await loadData(true); 
                lastId = data.latestId;
                lastTimestamp = data.latestTimestamp;
            }

            // ‡∏£‡∏≠ 3 ‡∏ß‡∏¥ ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ä‡πá‡∏Å‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
            await new Promise(r => setTimeout(r, 3000));

        } catch (err) {
            console.error("‚ùå Live update error:", err);
            await new Promise(r => setTimeout(r, 5000));
        }
    }
}

function init() {
    setupSearch();
    loadData();

    // ‚ùå ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ setInterval ‡πÅ‡∏•‡πâ‡∏ß
    // setInterval(() => { loadData(false); }, 30000);

    // ‚úÖ ‡πÉ‡∏ä‡πâ Live Update ‡πÅ‡∏ó‡∏ô
    startLiveUpdate();

    const refreshBtn = document.getElementById('refreshBtn');
    if (refreshBtn) {
        refreshBtn.onclick = manualRefresh;
    }
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
